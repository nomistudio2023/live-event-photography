# 清理隱藏文件使用說明

## 📍 在哪裡使用清理工具？

### 方式 1: 在 Admin 面板中（推薦）✅

1. 打開 Admin 面板：`http://localhost:8000`
2. 點擊右上角「⚙️ 設定」按鈕
3. 在「活動頁面設定」區塊中，找到「🧹 清理工具」
4. 點擊「🧹 清理隱藏文件」按鈕
5. 確認清理操作

**優點**：
- 不需要打開 Terminal
- 操作簡單
- 會自動刷新活動頁面

---

### 方式 2: 在 Terminal 中執行

1. **打開 Terminal**
2. **切換到專案目錄**：
   ```bash
   cd /Users/nomisas/.gemini/antigravity/scratch/live-event-photography
   ```
3. **執行清理工具**：
   ```bash
   python3 cleanup_hidden_files.py
   ```

**輸出範例**：
```
============================================================
🧹 清理 macOS 隱藏文件工具
============================================================

📂 檢查 Web 資料夾: /Volumes/詠松-2Tssd/.../photos_web
  ✅ 已刪除: ._15D_7466.jpg
  ✅ 已刪除: ._15D_7467.jpg
  ✅ 已刪除 2 個隱藏文件

📋 清理 manifest.json:
  原始: 22 個項目
  清理後: 11 個項目
  移除的隱藏文件: ['._15D_7466.jpg', ...]
  ✅ manifest.json 已清理

============================================================
✅ 清理完成！總共刪除 2 個隱藏文件
============================================================
```

---

## 🔄 自動清理機制

### 發布照片時自動清理

系統現在會在發布照片時自動：
1. 清理已存在的隱藏文件
2. 更新 manifest.json（自動過濾隱藏文件）
3. 驗證 manifest 是否乾淨

**但注意**：如果 macOS 在發布後才產生隱藏文件，可能需要手動清理。

---

## ⚠️ 為什麼會產生隱藏文件？

macOS 在以下情況會自動產生 `._` 開頭的文件：
- 將文件複製到外接硬碟/SSD
- 使用 Finder 操作文件
- 某些應用程式保存文件時

這些是 macOS 的資源分叉（resource fork）文件，用於儲存文件的額外資訊。

---

## 🎯 何時需要清理？

### 需要清理的情況：
- ✅ 發布照片後，活動頁面出現空白照片
- ✅ manifest.json 中包含 `._` 開頭的文件
- ✅ 定期維護（建議每天活動結束後清理一次）

### 不需要清理的情況：
- ✅ 剛剛發布照片，且活動頁面正常顯示
- ✅ manifest.json 中沒有 `._` 開頭的文件

---

## 📋 檢查是否需要清理

### 方法 1: 檢查 manifest.json

```bash
# 查看 manifest 內容
cat /Volumes/詠松-2Tssd/2026-live-event-photograghy-test-folder/photos_web/manifest.json
```

如果看到 `._` 開頭的文件，就需要清理。

### 方法 2: 檢查活動頁面

如果活動頁面出現空白照片，很可能是有隱藏文件在 manifest 中。

---

## 🔧 故障排除

### 問題 1: 清理後仍然有隱藏文件

**原因**：macOS 可能在清理後又產生了新的隱藏文件

**解決方案**：
1. 再次執行清理工具
2. 檢查是否有程式正在訪問這些文件
3. 考慮使用 `dot_clean` 命令（進階）

### 問題 2: 清理工具無法執行

**檢查**：
1. 確認在正確的目錄中
2. 確認 Python 3 已安裝：`python3 --version`
3. 確認文件權限：`ls -la cleanup_hidden_files.py`

---

## 💡 最佳實踐

1. **定期清理**：每天活動結束後執行一次清理
2. **發布後檢查**：發布照片後檢查活動頁面是否正常
3. **使用 Admin 面板**：方便快捷，不需要 Terminal

---

## 📞 需要幫助？

如果清理工具無法解決問題：
1. 檢查 Terminal 中的錯誤訊息
2. 確認資料夾路徑是否正確
3. 檢查文件權限

---

**最後更新**: 2026-01-23
