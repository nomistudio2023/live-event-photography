# å¾ŒçºŒé–‹ç™¼æ­¥é©Ÿ - æ¥çºŒé–‹ç™¼

**æ—¥æœŸ**: 2026-01-23  
**ç‹€æ…‹**: å·²å®Œæˆ Mac App å•Ÿå‹•è…³æœ¬ï¼Œå¾…æ¸¬è©¦é©—è­‰

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. **å‰µå»º Shell å•Ÿå‹•è…³æœ¬**
- âœ… `start_server.sh` - å•Ÿå‹• FastAPI Admin å¾Œå°
- âœ… `start_sync.sh` - å•Ÿå‹• R2 è‡ªå‹•åŒæ­¥è…³æœ¬
- âœ… å…©å€‹è…³æœ¬éƒ½å·²è¨­ç½®åŸ·è¡Œæ¬Šé™

### 2. **æ›´æ–° Mac App ç·¨è­¯è…³æœ¬**
- âœ… `update_mac_app_script.sh` - ç·¨è­¯æ–°çš„ AppleScript åˆ° app bundle

### 3. **Mac App å•Ÿå‹•å™¨æ”¹é€²**
- âœ… `launcher.applescript` å·²æ›´æ–°ï¼Œä½¿ç”¨ shell è…³æœ¬æ–¹å¼é¿å… Apple Events æ¬Šé™å•é¡Œ

---

## ğŸ”§ éœ€è¦åŸ·è¡Œçš„æ“ä½œ

### æ­¥é©Ÿ 1: æ›´æ–° Mac App ä¸­çš„ AppleScript

```bash
# ç·¨è­¯æ–°çš„ AppleScript åˆ° app bundle
./update_mac_app_script.sh
```

é€™æœƒå°‡æ›´æ–°å¾Œçš„ `launcher.applescript` ç·¨è­¯ä¸¦æ›¿æ›åˆ° `dist/Live Event Photo.app` ä¸­ã€‚

### æ­¥é©Ÿ 2: æ¸¬è©¦ Mac App å•Ÿå‹•

1. é›™æ“Š `dist/Live Event Photo.app`
2. æ‡‰è©²æœƒè‡ªå‹•æ‰“é–‹å…©å€‹ Terminal çª—å£ï¼š
   - ä¸€å€‹é‹è¡Œ `server.py`ï¼ˆæ¨™é¡Œï¼šLive Event Photo - Serverï¼‰
   - ä¸€å€‹é‹è¡Œ `sync_to_r2.py`ï¼ˆæ¨™é¡Œï¼šLive Event Photo - Syncï¼‰
3. ç€è¦½å™¨æ‡‰è©²è‡ªå‹•æ‰“é–‹ `http://localhost:8000`

**é æœŸçµæœ**ï¼š
- âœ… ä¸å†å‡ºç¾ "Not authorized to send Apple events to Terminal" éŒ¯èª¤
- âœ… å…©å€‹æœå‹™éƒ½æ­£å¸¸å•Ÿå‹•
- âœ… Admin é¢æ¿å¯ä»¥æ­£å¸¸è¨ªå•

### æ­¥é©Ÿ 3: æ¸¬è©¦ Unpublish â†’ R2 åŒæ­¥

1. åœ¨ Admin é¢æ¿ç™¼å¸ƒä¸€å¼µç…§ç‰‡
2. ç­‰å¾…åŒæ­¥åˆ° R2ï¼ˆæŸ¥çœ‹ sync Terminal çš„æ—¥èªŒï¼‰
3. åœ¨ Admin é¢æ¿é»æ“Š "Unpublish" åˆªé™¤è©²ç…§ç‰‡
4. æª¢æŸ¥ï¼š
   - âœ… æœ¬åœ° `photos_web/` ä¸­ç…§ç‰‡å·²åˆªé™¤
   - âœ… æœ¬åœ° `manifest.json` å·²æ›´æ–°
   - âœ… R2 ä¸Šçš„ç…§ç‰‡å·²åˆªé™¤ï¼ˆæª¢æŸ¥ sync Terminal æˆ–ä½¿ç”¨ `r2_manage.py list`ï¼‰
   - âœ… R2 ä¸Šçš„ `manifest.json` å·²æ›´æ–°

---

## ğŸ“‹ åŠŸèƒ½é©—è­‰æ¸…å–®

### Mac App å•Ÿå‹•
- [ ] é»æ“Š app ä¸å†å‡ºç¾æ¬Šé™éŒ¯èª¤
- [ ] è‡ªå‹•å•Ÿå‹• server.py
- [ ] è‡ªå‹•å•Ÿå‹• sync_to_r2.py
- [ ] è‡ªå‹•æ‰“é–‹ç€è¦½å™¨

### ç…§ç‰‡ç™¼å¸ƒæµç¨‹
- [ ] å¾ buffer é¸æ“‡ç…§ç‰‡
- [ ] èª¿æ•´ç·¨è¼¯åƒæ•¸ï¼ˆexposure, rotation, straighten, scaleï¼‰
- [ ] ç™¼å¸ƒç…§ç‰‡
- [ ] åŒä¸€ç…§ç‰‡å¤šæ¬¡ç™¼å¸ƒç”¢ç”Ÿåºè™Ÿæª”åï¼ˆ_002, _003...ï¼‰
- [ ] ç…§ç‰‡åŒæ­¥åˆ° R2

### ç…§ç‰‡åˆªé™¤æµç¨‹
- [ ] åœ¨ Admin é¢æ¿é»æ“Š Unpublish
- [ ] æœ¬åœ°ç…§ç‰‡åˆªé™¤
- [ ] æœ¬åœ° manifest.json æ›´æ–°
- [ ] R2 ç…§ç‰‡åˆªé™¤
- [ ] R2 manifest.json æ›´æ–°

### åŒæ­¥ç‹€æ…‹æŒ‡ç¤ºå™¨
- [ ] Admin é¢æ¿é¡¯ç¤ºåŒæ­¥ç‹€æ…‹
- [ ] sync_to_r2.py é‹è¡Œæ™‚é¡¯ç¤º "Syncing"ï¼ˆç¶ è‰²è„ˆè¡ï¼‰
- [ ] sync_to_r2.py æœªé‹è¡Œæ™‚é¡¯ç¤º "Offline"ï¼ˆé»ƒè‰²ï¼‰

---

## ğŸ› å·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: Mac App æ¬Šé™éŒ¯èª¤
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©  
**è§£æ±ºæ–¹æ¡ˆ**: æ”¹ç”¨ `do shell script "open -a Terminal '...'"` è€Œé `tell application "Terminal"`

### å•é¡Œ 2: åŒä¸€ç…§ç‰‡ç„¡æ³•é‡æ–°ç™¼å¸ƒ
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©  
**è§£æ±ºæ–¹æ¡ˆ**: å¯¦ç¾ `get_next_publish_filename()` å‡½æ•¸ï¼Œè‡ªå‹•ç”¢ç”Ÿåºè™Ÿæª”å

### å•é¡Œ 3: Unpublish ä¸åŒæ­¥åˆ° R2
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©  
**è§£æ±ºæ–¹æ¡ˆ**: åœ¨ `server.py` çš„ `/api/unpublish` ç«¯é»ä¸­æ·»åŠ  `sync_delete_to_r2()` å‡½æ•¸èª¿ç”¨

### å•é¡Œ 4: Manifest ç·©å­˜å•é¡Œ
**ç‹€æ…‹**: âœ… å·²ä¿®å¾©  
**è§£æ±ºæ–¹æ¡ˆ**: 
- Cloudflare Pages Function ä¸­å°‡ manifest.json çš„ `max-age` æ”¹ç‚º 5 ç§’
- å‰ç«¯åŠ æ™‚é–“æˆ³ç¹éç·©å­˜

---

## ğŸ“ ä»£ç¢¼è®Šæ›´æ‘˜è¦

### æ–°å¢æ–‡ä»¶
1. `start_server.sh` - å•Ÿå‹• server.py çš„ç¨ç«‹è…³æœ¬
2. `start_sync.sh` - å•Ÿå‹• sync_to_r2.py çš„ç¨ç«‹è…³æœ¬
3. `update_mac_app_script.sh` - æ›´æ–° Mac App ä¸­ AppleScript çš„è…³æœ¬

### ä¿®æ”¹æ–‡ä»¶
1. `launcher.applescript` - æ”¹ç”¨ shell è…³æœ¬å•Ÿå‹•æ–¹å¼
2. `server.py` - æ·»åŠ  `sync_delete_to_r2()` å‡½æ•¸å’Œ unpublish ç«¯é»çš„æ”¹é€²

---

## ğŸš€ ä¸‹ä¸€æ­¥é–‹ç™¼å»ºè­°

æ ¹æ“š `DEVELOPMENT_ROADMAP.md`ï¼Œå»ºè­°å„ªå…ˆè™•ç†ï¼š

1. **å¢å¼· Batch Publish åŠŸèƒ½**
   - æ”¯æ´æ¯å¼µç…§ç‰‡ç¨ç«‹è¨­å®šç·¨è¼¯åƒæ•¸
   - æ”¹é€² Admin UI æ‰¹é‡é¸æ“‡ä»‹é¢

2. **å¯¦ç¾ EXIF Metadata ä¿ç•™**
   - åœ¨ç…§ç‰‡è™•ç†æ™‚ä¿ç•™é‡è¦ EXIF è³‡è¨Š
   - ä½¿ç”¨ `Pillow` æˆ– `piexif` åº«

3. **Mobile Admin UI é©é…**
   - éŸ¿æ‡‰å¼ä½ˆå±€å„ªåŒ–
   - è§¸æ§æ‰‹å‹¢æ”¯æ´

---

## ğŸ“ æ¸¬è©¦å›å ±

å¦‚æœæ¸¬è©¦éç¨‹ä¸­ç™¼ç¾å•é¡Œï¼Œè«‹è¨˜éŒ„ï¼š
1. å•é¡Œæè¿°
2. é‡ç¾æ­¥é©Ÿ
3. é æœŸè¡Œç‚º vs å¯¦éš›è¡Œç‚º
4. ç›¸é—œæ—¥èªŒæˆ–éŒ¯èª¤è¨Šæ¯

---

**æœ€å¾Œæ›´æ–°**: 2026-01-23
